# Release Notes

## Involved Repositories

#### `livingdocs-editor`

- from version `v20.7.1` -> `v20.9.0`
- link to the release: https://github.com/upfrontIO/livingdocs-editor/tree/v20.9.0
- livingdocs-framework version: `^7.9.0`

#### `livingdocs-server`

- from version `v57.0.2` -> `v61.1.0`
- link to the release: https://github.com/upfrontIO/livingdocs-server/tree/v61.1.0
- livingdocs-framework version: `^7.9.0`

#### `livingdocs-framework` 

- no changes in the framework version, still `v7.9.0`.
- link to the release: https://github.com/upfrontIO/livingdocs-framework/tree/v7.9.0

## Component changes

Component | Type | Description | PRs | Issues
--- | --- | --- | --- | ---
Server | Bugfix | Enable cdata after updating xml2js to 0.4.18 | [bae17234](https://github.com/upfrontIO/livingdocs-server/commit/bae17234) | -
Server | BREAKING CHANGE, Feature | Categories API. [Read more](#categories-api) | [#1566](https://github.com/upfrontIO/livingdocs-server/pull/1566) | [#1288](https://github.com/upfrontIO/livingdocs-planning/issues/1288)
Server | Bugfix | Remove new channel configuration (accidentally slipped in) | [#1607](https://github.com/upfrontIO/livingdocs-server/pull/1607) | -
Server | Bugfix | Enable metadata in import. [Read more](#enable-metadata-in-import) | [#1615](https://github.com/upfrontIO/livingdocs-server/pull/1615) | [#1490](https://github.com/upfrontIO/livingdocs-planning/issues/1490)
Server | BREAKING CHANGE, Feature | Serializable Channel Configuration. [Read More](#serializable-channel-configuration) | [#1589](https://github.com/upfrontIO/livingdocs-server/pull/1589) | [#1348](https://github.com/upfrontIO/livingdocs-planning/issues/1348)
Server | BREAKING CHANGE | Remov–µ deprecated doc-include methods and pusher endpoint. [Read More](#removing-deprecated-doc-include-methods) | [#1613](https://github.com/upfrontIO/livingdocs-server/pull/1613) | 
https://github.com/upfrontIO/livingdocs-planning/issues/1430
Server | Feature | Add `getRoyaltyRecipients` endpoint | [#1606](https://github.com/upfrontIO/livingdocs-server/commit/1606) | -
Server | BREAKING CHANGE, Feature | `grunt-setup` works now properly within a docker container. [Read More](#grunt-setup-works-now-properly-within-a-docker-container) | [#1617](https://github.com/upfrontIO/livingdocs-server/pull/1617) | [#1041](https://github.com/upfrontIO/livingdocs-planning/issues/1041)
Server | Feature | Add document count to document-list endpoint. | [#1627](https://github.com/upfrontIO/livingdocs-server/pull/1627) | [#1471](https://github.com/upfrontIO/livingdocs-planning/issues/1471)
Editor | Bugfix | Show build settings on admin screen. | [#1646](https://github.com/upfrontIO/livingdocs-editor/pull/1646) | -
Editor | Bugfix | Update to new framework api. [Read More](#update-to-new-framework-api) | [#1651](https://github.com/upfrontIO/livingdocs-editor/pull/1651) | -
Editor | Bugfix | Use the correct package for semantic-release on maintenance branches | [#1654](https://github.com/upfrontIO/livingdocs-editor/pull/1654) | -
Editor | Bugfix | Allow print template selection on hugo import. | [#1656](https://github.com/upfrontIO/livingdocs-editor/pull/1656) | [#1490](https://github.com/upfrontIO/livingdocs-planning/issues/1490)
Editor | Bugfix | Apply print layout change to document metadata. [Read more](#apply-print-layout-change-to-document-metadata) | [#1658](https://github.com/upfrontIO/livingdocs-editor/pull/1658) | [#1469](https://github.com/upfrontIO/livingdocs-planning/issues/1469)
Editor | Feature | Enhance the list's dashboard with document count | [#1661](https://github.com/upfrontIO/livingdocs-editor/pull/1661) | [#1471](https://github.com/upfrontIO/livingdocs-planning/issues/1471)

### Known issues

Component | Type | Description | Issue
--- | --- | --- | ---

## In detail

## Categories API

### BREAKING CHANGE

In this pull request we're adding an experimental Categories api and did some renaming in the event sourcing setup.
Additionally to the new database table which is created by the database migration script, we also renamed some columns on the menu and groups tables.
If your setup automatically applies the migration, there's nothing you have to do. If that's not the case, you'll need to run `grunt migrate`.

### API

```js
const categories = liServer.features.api('li-categories')

categories.getCategoryTrees({projectId, channelId}, cb)
categories.getPublishedCategoryTree({projectId, channelId}, cb)
categories.getPublishedCategoryTrees({projectId, channelId, categoryTreeId}, cb)

// required params for all methods: {action, projectId, channelId, categoryTreeId, data}
//` action` must equal the method name
categories.createCategoryTree({params..., data: {label}, cb)
categories.publishCategoryTree(params, cb)
categories.deleteCategoryTree(params, cb)
categories.addCategory({params..., data: {id, label, slug, pathToHere, metadata}}, cb)
categories.updateCategory({params..., data: {id, label, slug, pathToHere, metadata}}, cb)
categories.removeCategory({params..., data: {id}}, cb)
categories.moveCategory({params..., data: {id, previous, parent}}, cb)
```

## Enable metadata in import

The data object passed to the HugoImportApi can now contain a metadata object. E.g. NZZ can use it to pass their print metadata to the importer so an imported print article can be exported correctly.

## Serializable Channel Configuration

- allow for the configuration to be serializable so we can store the channel configuration in the database.
- we currently have two configuration files per channel. This is changing into one channel configuration with many content types.
- here you can read more about it and have a look at the server configuration example: https://github.com/upfrontIO/livingdocs/blob/master/reference-docs/server-configuration/channel-config.md

## Removing deprecated doc-include methods

### BREAKING CHANGES

- The `registerServiceRenderer` method on the `server.features.api('li-includes')` feature was removed. Please use the `registerService` method, which was introduced in https://github.com/upfrontIO/livingdocs-server/pull/1470

- The method `includeApi.getServiceRendererMethod` got removed.
Please use `includeApi.resolveInclude` to render an include.

- We've removed the deprecated `/authenticate/pusher` endpoint. Please make sure your editor is up to date and that your pusher configuration isn't using that endpoint.  

- The url you should use  is `/pusher/authorize`:

  ```js
    pusher:
      isEnabled: true
      endpoint: '/pusher/authorize'
  ```

## `grunt-setup` works now properly within a docker container

- The config option `config.docker.enabled` has been replaced by `config.db.run_db_setup_commands_within_docker_container`.

- `config.db.run_db_setup_commands_within_docker_container` defaults to `true` and executes the db commands during `grunt setup` in a docker container. `grunt setup` is not supported, when you start docker containers with `docker-compose` and point to a container by a dns name.

- `config.db.run_db_setup_commands_within_docker_container = false` executes the db commands during `grunt setup` on the host system. For that `createdb` and `dropdb` needs to be available as binaries on the host system.

- the documentation has been updated as well: https://github.com/upfrontIO/livingdocs/pull/136/files.

## Update to new framework api

The framework's `livingdoc` objects has changed its signature with regard to removing event listerners. The following code does not work anymore:

    livingdoc.off()

It was replaced by:

    livingdoc.removeListener()

## Apply print layout change to document metadata

Each time when the metadata was applied to the document (e.g. `document.update()`) the metadata reference which was passed to the `MetadataService` in the `Workspace` went stale and metadata updates didn't arrive on the document.
