# Release Notes: `November/December 2017 Release`

## Repositories

This release consists of the following new versions of the `livingdocs-server`, the `livingdocs-editor` and the `livingdocs-framework`:

Package | Version
--- | ---
`@livingdocs/server` | `64.0.1`
`@livingdocs/editor` | `25.3.1`
`@livingdocs/framework` | `8.0.5`

### Livingdocs Server

How to require the server in your package.json:

```json
"dependencies": {
  "@livingdocs/server": "64.0.1",
}
```

- Link to the release branch:
  https://github.com/upfrontIO/livingdocs-server/tree/release-2017-12
- Previous release: [63.2.1](https://github.com/upfrontIO/livingdocs-release-notes/blob/master/releases/release-2017-10.md#livingdocs-server)

### Livingdocs Editor

How to require the editor in your package.json:

```json
"dependencies": {
  "@livingdocs/editor": "25.3.1",
}
```

- Link to the release branch:
  https://github.com/upfrontIO/livingdocs-editor/tree/release-2017-12
- Previous release: [23.0.3](https://github.com/upfrontIO/livingdocs-release-notes/blob/master/releases/release-2017-10.md#livingdocs-editor)

### Livingdocs Framework

The framework is already integrated in the package.json of the upstream server and editor. It's **not** necessary to integrate the framework from your side.

The framework does not have a release branch.

How to require the framework in your package.json:

```json
dependencies: {
  "@livingdocs/framework": "8.0.5"
}
```
- Previous release: [7.14.0](https://github.com/upfrontIO/livingdocs-release-notes/blob/master/releases/release-2017-10.md#livingdocs-framework)

## Component changes

### Known issues

Component | Type | Description | PRs | Issues
--- | --- | --- | --- | ---
Application wide | BREAKING CHANGE | Move image service config from the client [Read more](#move-image-service-config-from-the-client) | [#268](https://github.com/upfrontIO/livingdocs-framework/pull/268), [#1708](https://github.com/upfrontIO/livingdocs-server/pull/1708), [#1746](https://github.com/upfrontIO/livingdocs-editor/pull/1746) | [#1532](https://github.com/upfrontIO/livingdocs-planning/issues/1532)
Framework | Feature | New server side one-time rendering (without jQuery and jsdom) [Read more](#new-server-side-one-time-rendering-without-jQuery-and-jsdom) | [#161](https://github.com/upfrontIO/livingdocs-framework/pull/161) | -
Framework | Bugfix | Webpack 3 upgrade | [#272](https://github.com/upfrontIO/livingdocs-framework/pull/272) | -
Framework | Bugfix | Remove unused semantic-release-verify-patch | [#274](https://github.com/upfrontIO/livingdocs-framework/pull/274) | -
Framework | Bugfix | Bump upfront-editable from 1.3.1 to 1.4.2 | [#275](https://github.com/upfrontIO/livingdocs-framework/pull/275) | -
Framework | Bugfix | Revert usage of es2015 | [#271](https://github.com/upfrontIO/livingdocs-framework/pull/271) | -

## In detail

### Move image service config to the server only

We removed the default configuration `imageServices.sz.shaSecret`. Here is an example how to manually set the `shaSecret` should you need it:

```js
  documents: {
    imageServices: {
      'sz': {
        host: 'https://sz.de',
        shaSecret: 'please-change-me-in-the-server-configuration',
        hashVersion: 1,
        srcSet: {
          defaultWidth: 1280,
          widths: [2048, 1280, 980, 720],
          sizes: ['(max-width: 980px) 80vw', '(max-width: 720px) 100vw', '60vw']
        }
      }
    }
  }
```

Here is an example change for the `resrc.it` image service:

Remove the `imageServiceConfig` key in the editor's configuration, from:

```coffee
app:
    imageService: 'resrc.it'
    imageServiceConfig:
      host: 'https://app.resrc.it'
      quality: 75
      scriptUrl: '//d2o08py1e264ss.cloudfront.net/assets/resrc-0.9.0.min.js'
```

To:

```coffee
app:
    imageService: 'resrc.it'
```

Make sure to replicate the configuration you removed from the editor in the server, like:

```js
  documents: {
    imageServices: {
      'resrc.it': {
        host: 'https://app.resrc.it',
        quality: 75,
        scriptUrl: '//d2o08py1e264ss.cloudfront.net/assets/resrc-0.9.0.min.js'
      }
    }
  }
```

### New server side one-time rendering (without jQuery and jsdom)

```js
const li = require('@livingdocs/framework')
const livingdoc = li.createLivingdoc(...)
// add some content to the livingdoc

// The method render() is an addition so we can test if
// it produces the same output as livingdoc.html()
livingdoc.render()
```

#### Render Example with Includes

```js
const livingdocs = require('@livingdocs/framework')

// ... create your livingdoc

// resolve includes
componentTree.each((component) => {
  if (component.componentName === 'include') {
    const includeDirective = component.directives.get('remote')
    includeDirective.resolve(`
      <article>
        External Content
      </article>
    `)
  }
})

// render the component tree with a wrapper
const result = livingdocs.rendering.render({
  wrapperHtml: '<section doc-container="content"></section>'
  componentTree: componentTree
})
```

## Performance Testing

Performance tests can be setup in `test/performance/rendering_perf` and other files suffixed with `_perf`. What is being run should be required in `test/performance/runner.js`.

Run the performance tests:
```bash
node test/performance/runner.js
```

## Include Directive

`setParams()` was added to the include directive.

```js
includeDirective.setContent({
  service: 'list',
  params: {foo: 'bar'}
})

// Retrieve the params set on a directive (this includes defaultParams
// specified in the component configuration if they have not been overwritten).
includeDirective.getParams()


// setParams overwrites all parameters of this include.
includeDirective.setParams({foo: 'fighters'})

// addParams merges the specified params with the existing ones
// (including any default params that may have been set in the component
// configuration).
includeDirective.addParams({foo: 'bar'})
```

`resolve()` was added to the include directive.
```js
includeDirective.resolve('<div>string with arbitrary HTML</div>')

// Check if an include was already resolved
includeDirective.isResolved() // true
```

The `resolve()` method does only have an impact when a component tree is rendered with the one time rendering. It is not used by the dynamic renderer.

Resolved values are not persisted. If you serialize a document with resolved includes the resolved values will not be included in the JSON you get.

## Patches

### Editor

### Server
